from priodict import priorityDictionary
import numpy as np
import combined as cb

def fun_Dijkstra(G,start,end=None):
    D = {} #slownik koncowy drzewa rozpinajacego
    P ={} #slownik poprzednikow
    Q = priorityDictionary()
    Q[start] = 0

    for v in Q:
        D[v] = Q[v]
        if v == end: break


        for w in G[v]:
            edge_length = D[v] + G[v][w]
            if w in D:
                if edge_length < D[w]:
                    raise ValueError
            elif w not in Q or edge_length < Q[w]:
                Q[w] = edge_length
                P[w] = v
    return (D,P)


def convert_strlist_to_intlist(stringList):

    intList = []
    for x in stringList:
        intList.append(int(x[1:]))
    return intList

def shortestPath(G,start,end):

        D,P = fun_Dijkstra(G,start,end)
        Path = []
        while 1:
            Path.append(end)
            if end == start: break
            end = P[end]
        Path.reverse()
        return Path

def getRoute(chosenList):

    G = {'A0': {'A1': 34.0},
         'A1': {'A0': 34.0, 'A2': 90.0, 'A5': 90.0},
         'A2': {'A1': 90.0, 'A131': 61.0, 'A122': 86.0},
         'A3': {'A131': 61.0, 'A132': 90.0, 'A106': 119.0},
         'A4': {'A132': 90.0, 'A5': 122.0, 'A136': 56.5},
         'A5': {'A4': 122.0, 'A6': 46.1, 'A1': 90.0},
         'A6': {'A5': 46.1, 'A7': 97.0},
         'A7': {'A129': 31.0, 'A8': 35.1, 'A6': 97.0},
         'A8': {'A82': 165.0, 'A9': 15.6, 'A7': 35.1},
         'A9': {'A10': 68.5, 'A8': 15.6},
         'A10': {'A9': 68.5, 'A11': 24.0},
         'A11': {'A10': 24.0, 'A12': 50.0},
         'A12': {'A11': 50.0, 'A13': 78.7},
         'A13': {'A12': 78.7, 'A14': 88.5, 'A15': 93.7},
         'A14': {'A13': 88.5},
         'A15': {'A79': 41.6, 'A13': 93.7, 'A78': 56.6},
         'A16': {'A13': 30.4, 'A17': 70.1, 'A20': 56.4},
         'A17': {'A16': 70.1, 'A18': 30.1},
         'A18': {'A17': 30.1, 'A19': 27.5},
         'A19': {'A18': 27.5, 'A45': 17.0, 'A43': 40.0},
         'A20': {'A16': 56.4, 'A21': 20.6, 'A41': 42.7},
         'A21': {'A20': 20.6, 'A22': 46.5},
         'A22': {'A21': 46.5, 'A23': 26.1},
         'A23': {'A22': 26.1, 'A24': 31.0},
         'A24': {'A23': 31.0, 'A39': 54.0, 'A130': 55.0},
         'A25': {'A24': 26.9, 'A26': 54.3},
         'A26': {'A25': 54.3, 'A27': 59.1},
         'A27': {'A26': 59.1, 'A28': 62.5},
         'A28': {'A29': 80.2, 'A27': 62.5, 'A130': 67.0},
         'A29': {'A28': 80.2, 'A30': 30.8},
         'A30': {'A29': 30.8, 'A31': 36.7},
         'A31': {'A30': 36.7, 'A32': 64.0},
         'A32': {'A31': 64.0, 'A33': 26.9, 'A59': 102.2},
         'A33': {'A32': 26.9, 'A58': 56.5, 'A34': 28.3},
         'A34': {'A35': 27.3, 'A33': 28.3, 'A48': 66.0},
         'A35': {'A34': 27.3, 'A36': 38.0},
         'A36': {'A35': 38.0, 'A37': 26.2},
         'A37': {'A38': 84.2, 'A36': 26.2, 'A44': 39.0},
         'A38': {'A37': 84.2, 'A39': 47.9, 'A130': 33.0},
         'A39': {'A38': 47.9, 'A24': 54.0, 'A40': 52.0},
         'A40': {'A39': 52.0, 'A41': 24.4, 'A44': 57.0},
         'A41': {'A20': 42.7, 'A40': 24.4, 'A42': 50.4},
         'A42': {'A41': 50.4, 'A43': 26.3, 'A45': 74.4},
         'A43': {'A42': 26.3, 'A44': 34.2},
         'A44': {'A43': 34.2, 'A37': 39.0},
         'A45': {'A19': 17.0, 'A46': 21.2, 'A77': 28.4},
         'A46': {'A45': 21.2, 'A47': 20.0},
         'A47': {'A46': 20.0, 'A48': 15.1},
         'A48': {'A47': 15.1, 'A34': 66.0, 'A49': 34.2},
         'A49': {'A48': 34.2, 'A50': 90.2},
         'A50': {'A49': 90.2, 'A51': 36.1, 'A75': 44.4},
         'A51': {'A50': 36.1, 'A52': 73.8},
         'A52': {'A51': 73.8, 'A53': 23.1},
         'A53': {'A52': 23.1, 'A54': 15.5},
         'A54': {'A53': 15.5, 'A55': 15.0},
         'A55': {'A54': 15.0, 'A56': 32.0, 'A63': 27.0},
         'A56': {'A57': 111.2, 'A62': 56.2},
         'A57': {'A56': 111.2, 'A58': 23.4, 'A59': 59.7},
         'A58': {'A57': 23.4, 'A33': 56.5},
         'A59': {'A57': 59.7, 'A60': 79.0},
         'A60': {'A59': 79.0, 'A61': 54.7},
         'A61': {'A60': 54.7, 'A62': 15.0, 'A63': 64.6},
         'A62': {'A61': 15.0, 'A56': 56.2},
         'A63': {'A61': 64.6, 'A65': 14.4, 'A55': 27.0},
         'A64': {'A65': 107.0, 'A66': 35.5},
         'A65': {'A63': 14.4, 'A64': 107.0},
         'A66': {'A64': 35.5, 'A67': 62.6},
         'A67': {'A75': 51.0, 'A68': 43.1},
         'A68': {'A67': 43.1, 'A69': 30.0},
         'A69': {'A70': 20.6, 'A72': 61.7},
         'A70': {'A91': 16.1, 'A69': 20.6, 'A137': 27.0},
         'A71': {'A137': 27.0, 'A72': 33.6, 'A84': 47.8},
         'A72': {'A71': 33.6, 'A73': 47.8},
         'A73': {'A72': 47.8, 'A74': 38.1, 'A76': 19.0},
         'A74': {'A73': 38.1, 'A75': 50.2},
         'A75': {'A74': 50.2, 'A50': 44.4, 'A67': 51.0},
         'A76': {'A73': 19.0, 'A80': 29.2, 'A81': 55.9},
         'A77': {'A45': 28.4, 'A78': 24.7, 'A80': 82.2},
         'A78': {'A77': 24.7, 'A15': 56.6},
         'A79': {'A15': 41.6, 'A81': 71.9},
         'A80': {'A76': 29.2, 'A77': 82.2},
         'A81': {'A79': 71.9, 'A83': 37.0},
         'A82': {'A83': 35.0, 'A8': 165.0},
         'A83': {'A81': 37.0, 'A82': 35.0, 'A85': 26.2},
         'A84': {'A85': 22.0, 'A86': 35.4, 'A138': 50.5},
         'A85': {'A83': 26.2, 'A84': 22.0, 'A86': 22.6},
         'A86': {'A85': 22.6, 'A84': 35.4, 'A129': 174.0},
         'A87': {'A86': 42.8, 'A102': 71.0, 'A100': 65.6},
         'A88': {'A138': 50.5, 'A89': 29.0, 'A91': 40.0},
         'A89': {'A88': 29.0, 'A90': 44.1},
         'A90': {'A89': 44.1, 'A91': 28.3},
         'A91': {'A70': 16.1, 'A88': 40.0, 'A90': 28.3},
         'A92': {'A134': 41.7, 'A93': 40.2, 'A94': 75.5},
         'A93': {'A92': 40.2},
         'A94': {'A92': 75.5, 'A95': 61.4, 'A108': 44.0},
         'A95': {'A94': 61.4},
         'A96': {'A94': 30.4, 'A97': 32.0, 'A105': 34.0},
         'A97': {'A92': 31.6, 'A96': 32.0, 'A98': 37.5},
         'A98': {'A97': 37.5, 'A99': 26.2},
         'A99': {'A98': 26.2, 'A100': 21.4},
         'A100': {'A87': 65.6, 'A99': 21.4, 'A101': 33.9},
         'A101': {'A100': 33.9, 'A102': 75.3},
         'A102': {'A87': 71.0, 'A101': 75.3, 'A136': 56.5},
         'A103': {'A104': 35.5, 'A106': 54.0},
         'A104': {'A103': 35.5, 'A105': 24.2},
         'A105': {'A104': 24.2, 'A107': 18.4, 'A96': 34.0},
         'A106': {'A103': 54.0, 'A107': 52.0, 'A3': 119.0},
         'A107': {'A106': 52.0, 'A120': 62.9, 'A108': 42.5},
         'A108': {'A107': 42.5, 'A94': 44.0, 'A109': 35.7},
         'A109': {'A108': 35.7, 'A110': 31.8},
         'A110': {'A109': 31.8, 'A111': 42.6},
         'A111': {'A110': 42.6, 'A112': 31.8},
         'A112': {'A111': 31.8, 'A113': 63.5},
         'A113': {'A112': 63.5, 'A114': 67.9, 'A118': 41.3},
         'A114': {'A113': 67.9, 'A115': 57.0},
         'A115': {'A114': 57.0, 'A135': 59.3},
         'A116': {'A135': 59.3, 'A117': 67.0},
         'A117': {'A116': 67.0, 'A118': 76.7},
         'A118': {'A117': 76.7, 'A113': 41.3},
         'A119': {'A121': 72.0, 'A127': 50.8, 'A3': 64.0},
         'A120': {'A121': 55.7, 'A107': 62.9},
         'A121': {'A120': 55.7, 'A119': 72.0},
         'A122': {'A2': 86.0, 'A127': 74.1, 'A123': 37.1},
         'A123': {'A122': 37.1, 'A124': 41.0, 'A125': 27.0},
         'A124': {'A126': 37.7, 'A123': 41.0, 'A127': 60.0},
         'A125': {'A123': 27.0, 'A126': 21.2},
         'A126': {'A125': 21.2, 'A124': 37.7},
         'A127': {'A122': 74.1, 'A124': 60.0, 'A119': 50.8},
         'A128': {'A1': 34.0},
         'A129': {'A4': 45.0, 'A7': 31.0, 'A86': 174.0},
         'A130': {'A24': 55.0, 'A28': 67.0, 'A38': 33.0},
         'A131': {'A2': 61.0, 'A3': 61.0},
         'A132': {'A133': 41.0, 'A3': 90.0, 'A4': 90.0},
         'A133': {'A132': 41.0},
         'A134': {'A92': 41.7, 'A87': 41.7},
         'A135': {'A115': 59.3, 'A116': 59.3},
         'A136': {'A4': 56.5, 'A102': 56.5},
         'A137': {'A70': 27.0, 'A71': 27.0},
         'A138': {'A84': 50.5, 'A88': 50.5}, }

    all = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46]
    # del all[1]
    for i in range(0, len(chosenList)):
        all.remove(chosenList[i])
        todelete = all
    print(todelete)


    W=[]
    zz = None
    yy='A0'
    distance,route = (cb.CreateDistanceCallback(todelete,0)).Path()
    print(route)

    I = [route, np.ndarray.tolist(np.ones(len(route)))]

    for i in range(0,len(I[1])):
        if I[1][i] == 1:
            zz = I[0][i]
            print(shortestPath(G, yy, zz))
            arr=shortestPath(G, yy, zz)
            arr=arr[:-1]
            W=np.append(W,arr)
            yy=zz

    W=np.append(W,'A0')
    print(W)
    intW = convert_strlist_to_intlist(W)

    return intW

# print(W)
if __name__ == '__main__':
    # print(W)
    print(getRoute([]))